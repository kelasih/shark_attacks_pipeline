services:
  ansible:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ansible-runner
    volumes:
      - ..:/infra
      - /var/run/docker.sock:/var/run/docker.sock
    working_dir: /infra/ansible
    command: >
      bash -c '
        if [ -z "$PLAYBOOK" ]; then
          echo "‚ùå ERROR: No PLAYBOOK specified.";
          echo "Usage: PLAYBOOK=<playbook.yml> docker-compose up";
          echo "Available playbooks:"; ls playbooks;
          exit 1;
        fi;
        echo "üöÄ Running playbook: $PLAYBOOK";
        ansible-playbook -i inventory.ini playbooks/$PLAYBOOK &&
        echo "‚úÖ Finished playbook: $PLAYBOOK";
      '
